Class
	name: #FLLargeIdentityHashedCollection;
	superclass: #ClassCollection;
	instanceSpecification: #(#pointers #words );
	instanceVariables: #(#tally #tallies );
	classVariables: #(#PermutationMap );
	package: #'Fuel-Collections'.

Class FLLargeIdentityHashedCollection >> initialize
[
tally := 0.tallies := Array new: 4096 withAll: 0
]

Class FLLargeIdentityHashedCollection >> postCopy
[
tallies := tallies copy
]

Class FLLargeIdentityHashedCollection >> size
[
^ tally
]

Metaclass
	name: #FLLargeIdentityHashedCollection;
	instanceVariables: #().

Metaclass FLLargeIdentityHashedCollection >> initialize
[
| rng |rng := Random seed: 664399324.PermutationMap := (0 to: 4095) asArray shuffleBy: rng
]

Metaclass FLLargeIdentityHashedCollection >> permuteHash: anInteger
[
	"Return an integer between 1 and 4096 when the argument is between 1 and 4096."
^ PermutationMap at: anInteger
]

